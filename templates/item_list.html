<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <title>Список товарів</title>
    <script>
      function showSizeModal(itemId) {
        document.getElementById(`size-modal-${itemId}`).style.display = 'block';
      }

      function addSize(event, itemId) {
        event.preventDefault();
        const form = event.target;
        const newSize = form.new_size.value;
        
        fetch(`/copy_item/${itemId}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ size: newSize }) 
        })
        .then(res => res.json())
        .then(data => {
          alert(data.message);
          location.reload(); // перезавантажити сторінку
        })
        .catch(err => console.error('Помилка:', err));
      }
    </script>
</head>
<body>
    <div class="d-flex flex-column flex-md-row align-items-center pb-3 mb-4 border-bottom">
        <a href="{{ url_for('index') }}" class="d-flex align-items-center link-body-emphasis text-decoration-none">
          <span class="fs-4">Clothing shop</span>
        </a>
  
        <nav class="d-inline-flex mt-2 mt-md-0 ms-md-auto">
          <a class="me-3 py-2 link-body-emphasis text-decoration-none" href="{{ url_for('clothing') }}">Clothing</a>
          <a class="me-3 py-2 link-body-emphasis text-decoration-none" href="{{ url_for('shoes') }}">Shoes</a>
          <a class="me-3 py-2 link-body-emphasis text-decoration-none" href="{{ url_for('accessories') }}">Accessories</a>
          <a class="me-3 py-2 link-body-emphasis text-decoration-none" href="{{ url_for('logout') }}">
            <img src="{{ url_for('static', filename='logout.png') }}" alt="logout" width="25" height="25">
          </a>
        </nav>
      </div>

    <br>
    <div class="container_item">
      <a href="{{ url_for('personal_page') }}">
        <img src="{{ url_for('static', filename='arrow-left.png') }}" alt="Log in" style="width: 40px; height: 40px" >
      </a>
      <a href="{{ url_for('add_items')}}">
        <img src="{{ url_for('static', filename='plus.png') }}" alt="Add item" style="width: 50px; height: 50px" >
      </a>
    </div>
    <br>

    <h2 align="center">List of products</h2>
    <hr><br>

    <div id="item-cards" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    </div>

    <script>
        fetch('/api/items')
          .then(response => response.json())
          .then(data => {
            const container = document.getElementById('item-cards');
    
            data.forEach(item => {
              const col = document.createElement('div');
              col.className = 'col';
    
              col.innerHTML = `
                <div class="card mb-3 p-3 h-100 text-center">
                    <img src="/static/${item.image.split('static/').pop()}" class="card-img-top mx-auto mb-2" alt="Зображення">
                    
                    <h5 class="mb-1">${item.name}</h5>
                    <p class="text-muted mb-2"><strong>${item.brand}</strong></p>
                    
                    <ul class="list-unstyled mb-3 text-start">
                        <li><strong>Price:</strong> ${item.price}$</li>
                        <li><strong>Size:</strong> ${item.size || '-'}</li>
                        <li><strong>Category:</strong> ${item.category || '-'}</li>
                        <li><strong>Sub-category:</strong> ${item.sub_category || '-'}</li>
                        <li><strong>Amount:</strong> ${item.amount}</li>
                    </ul>

                    <button class="btn btn-outline-dark" onclick="showSizeModal(${ item.id })">
                      Add size
                    </button>
                    <br>
                    
                    <form action="/api/items/${item.id}" method="POST" onsubmit="return confirm('Remove product?');">
                        <input type="hidden" name="_method" value="DELETE">
                        <button type="button" class="btn btn-outline-danger" onclick="deleteItem(${item.id}, this)">
                            <img src="/static/trash.png" alt="Видалити" width="25" height="25">
                        </button>
                    </form>
                    <div id="size-modal-${ item.id }" style="display:none;">
                    <form onsubmit="addSize(event, ${item.id})">
                      <input type="text" name="new_size" placeholder="New size" required>
                      <button type="submit" class="btn btn-dark">Add</button>
                    </form>
                    </div>
                </div>
                `;
    
              container.appendChild(col);
            });
          })
          .catch(error => {
            console.error('Помилка при завантаженні товарів:', error);
          });
    
        function deleteItem(itemId, button) {
          fetch(`/api/items/${itemId}`, {
            method: 'DELETE'
          })
          .then(response => {
            if (response.ok) {
              button.closest('.col').remove();
            } else {
              alert('Не вдалося видалити товар.');
            }
          });
        }
      </script>


    <footer class="row row-cols-1 row-cols-sm-2 row-cols-md-5 py-5 my-5 border-top">
        <div class="col mb-3">
            <h5>HELP AND INFORMATION</h5>
            <ul class="nav flex-column">
                <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">About Clothing shop</a></li>
                <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">Shop rules</a></li>
                <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">Return conditions</a></li>
                <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">Cooperation</a></li>
                <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">Frequently asked questions</a></li>
                <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">Contact</a></li>
                <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">Privacy Policy</a></li>
            </ul>
        </div>
  
        <div></div>
    
        <div class="col mb-3">
          <h5>DELIVERY</h5>
          <ul class="nav flex-column">
            <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">To the post office</a></li>
            <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">By courier</a></li>
          </ul>
        </div>
        
        <div></div>
    
        <div class="col mb-3">
          <h5>PAYMENT</h5>
          <ul class="nav flex-column">
            <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">By bank card</a></li>
            <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-body-secondary">Postpaid</a></li>
          </ul>
        </div>
    </footer>
</body>
</html>